<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConvoReport - Upload</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
<body>
    <div class="container">
        <header>
            <h1>Upload Conversation</h1>
            <p class="subtitle">Select your audio file and preferences</p>
        </header>
        
        <form id="uploadForm" action="/process_audio" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <label for="audioFile">Upload Audio File</label>
                <div class="file-upload" id="dropArea">
                    <input type="file" id="audioFile" accept="audio/*" name="audioFile">
                    <i>ðŸŽ¤</i>
                    <p id="fileStatus">Click or drag audio file here</p>
                </div>
            </div>
            
            <div class="form-group">
                <label>Report Type</label>
                <div class="option-group">
                    <div class="option-box selected" data-value="brief">
                        <h3>Brief</h3>
                        <p>Concise summary with key points</p>
                    </div>
                    <div class="option-box" data-value="detailed">
                        <h3>Detailed</h3>
                        <p>Comprehensive analysis and full transcript</p>
                    </div>
                </div>
                <input type="hidden" id="reportType" name="reportType" value="brief">
            </div>
            
            <div class="form-group">
                <label for="modelType">Model Size</label>
                <select id="modelType" name="whisperModelSize">
                    <option value="tiny">Tiny (Fastest)</option>
                    <option value="small">Small (Fast)</option>
                    <option value="base" selected>Base (Recommended)</option>
                    <option value="medium">Medium (Most Accurate)</option>
                </select>
            </div>
            
            <div class="center-content">
                <button type="submit" class="btn" id="generateBtn">Generate Report</button>
                <a href="/" class="btn btn-secondary">Back</a>
            </div>
        </form>
        
        <footer>
            <p>&copy; 2025 ConvoReport. All rights reserved.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Option box selection
            const optionBoxes = document.querySelectorAll('.option-box');
            optionBoxes.forEach(box => {
                box.addEventListener('click', function() {
                    optionBoxes.forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    document.getElementById('reportType').value = this.dataset.value;
                });
            });
            
            // File upload handling
            const fileInput = document.getElementById('audioFile');
            const fileStatus = document.getElementById('fileStatus');
            
            fileInput.addEventListener('change', function() {
                const file = this.files[0];
                if (file) {
                    fileStatus.textContent = `Selected: ${file.name}`;
                } else {
                    fileStatus.textContent = 'Click or drag audio file here';
                }
            });
            
            // Drag and drop handling
            const dropArea = document.getElementById('dropArea');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.style.borderColor = 'var(--secondary-color)';
                dropArea.style.backgroundColor = 'rgba(230, 247, 255, 0.8)';
            }
            
            function unhighlight() {
                dropArea.style.borderColor = 'var(--border-color)';
                dropArea.style.backgroundColor = 'var(--primary-color)';
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length > 0) {
                    fileInput.files = files;
                    fileStatus.textContent = `Selected: ${files[0].name}`;
                }
            }
            
            // Click on drop area to trigger file input
            dropArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            // Store model type in localStorage
            const modelType = document.getElementById('modelType');
            modelType.addEventListener('change', function() {
                localStorage.setItem('modelType', this.value);
            });
            
            // Set initial model value
            localStorage.setItem('modelType', modelType.value);
            
            // Form submission
            const uploadForm = document.getElementById('uploadForm');
            uploadForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const audioFile = fileInput.files[0];
                const reportType = document.getElementById('reportType').value;
                const modelType = document.getElementById('modelType').value;
                
                if (!audioFile) {
                    alert('Please upload an audio file first.');
                    return;
                }
                
                // Store values for the report page
                localStorage.setItem('fileName', audioFile.name);
                localStorage.setItem('reportType', reportType);
                
                // Submit the form (let the backend handle redirect)
                uploadForm.submit();
            });
        });
    </script>
</body>
</html>